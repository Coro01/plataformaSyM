{% extends "control_horas/base.html" %}
{% load humanize %} 

{% block horizontal_breadcrumbs %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{% url 'control_horas:main_dashboard' %}">Inicio</a></li>
        <li class="breadcrumb-item"><a href="{% url 'compras:compras_dashboard' %}">Compras</a></li>
        <li class="breadcrumb-item"><a href="{% url 'compras:deposito' %}">Inventario</a></li>
        <li class="breadcrumb-item"><a href="{% url 'compras:detalle_producto' pk=producto.CodigoProducto %}">{{ producto.Producto }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">Editar</li>
    </ol>
</nav>
{% endblock horizontal_breadcrumbs %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<script src="https://cdn.tailwindcss.com"></script>

<style>
    :root {
        --burgundy-main: #7D1935;
        --burgundy-hover: #5A1327;
        --soft-gray-bg: #f5f7fa;
        --text-dark: #1f2937;
    }
    body { background-color: var(--soft-gray-bg); font-family: 'Inter', sans-serif; }
    .text-burgundy-main { color: var(--burgundy-main); }
    .bg-burgundy-main { background-color: var(--burgundy-main); }
    .hover\:bg-burgundy-hover:hover { background-color: var(--burgundy-hover); }
    .shadow-minimal { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
</style>

<div class="max-w-4xl mx-auto py-8 sm:py-12 px-4 sm:px-6 lg:px-8">
    
    <header class="mb-10 pb-6 border-b border-gray-300">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-text-dark flex items-center mb-2">
            <i class="bi bi-pencil-square text-burgundy-main me-3 text-4xl"></i>
            Editar Producto
        </h1>
        <p class="text-gray-600 text-base font-medium">
            Modifica los datos del producto: <span class="font-mono font-bold text-burgundy-main">{{ producto.CodigoProducto }}</span>
        </p>
    </header>

    <div class="bg-white rounded-xl shadow-minimal ring-1 ring-gray-100 p-8 sm:p-10">
        
        <form method="POST" class="space-y-8">
            {% csrf_token %}

            <!-- SECCIÓN 1: INFORMACIÓN BÁSICA -->
            <div class="border-b pb-8">
                <h2 class="text-xl font-bold text-text-dark mb-6 flex items-center">
                    <i class="bi bi-info-circle text-burgundy-main me-2"></i>
                    InformaciÃ³n BÃ¡sica
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Código del Producto (Solo lectura) -->
                    <div>
                        <label for="codigo" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-code-square me-1"></i> CÃ³digo de Producto (SKU)
                        </label>
                        <input type="text" 
                               id="codigo" 
                               value="{{ producto.CodigoProducto }}" 
                               disabled
                               class="block w-full rounded-lg border border-gray-300 px-4 py-3 bg-gray-100 text-gray-700 font-mono font-bold cursor-not-allowed">
                        <p class="text-xs text-gray-500 mt-1">No se puede modificar el cÃ³digo</p>
                    </div>

                    <!-- Nombre del Producto -->
                    <div>
                        <label for="producto_nombre" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-box-seam me-1"></i> Nombre del Producto *
                        </label>
                        <input type="text" 
                               name="producto_nombre" 
                               id="producto_nombre"
                               value="{{ producto_nombre }}"
                               required
                               placeholder="Ej: Monitor LG 24 pulgadas"
                               class="block w-full rounded-lg border border-gray-300 px-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                    </div>

                    <!-- Marca -->
                    <div>
                        <label for="marca" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-palette-fill me-1"></i> Marca
                        </label>
                        <input type="text" 
                               name="marca" 
                               id="marca"
                               value="{{ marca }}"
                               placeholder="Ej: LG, Sony, Dell"
                               class="block w-full rounded-lg border border-gray-300 px-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                    </div>

                    <!-- Modelo -->
                    <div>
                        <label for="modelo" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-gear-fill me-1"></i> Modelo *
                        </label>
                        <input type="text" 
                               name="modelo" 
                               id="modelo"
                               value="{{ modelo }}"
                               required
                               placeholder="Ej: 24UP550-W"
                               class="block w-full rounded-lg border border-gray-300 px-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                    </div>

                    <!-- UbicaciÃ³n -->
                    <div>
                        <label for="ubicacion" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-geo-alt-fill me-1"></i> UbicaciÃ³n *
                        </label>
                        <input type="text" 
                               name="ubicacion" 
                               id="ubicacion"
                               value="{{ ubicacion }}"
                               required
                               placeholder="Ej: Estante A-1, DepÃ³sito 2"
                               class="block w-full rounded-lg border border-gray-300 px-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                    </div>
                </div>

                <!-- DescripciÃ³n -->
                <div class="mt-6">
                    <label for="descripcion" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="bi bi-card-text me-1"></i> DescripciÃ³n
                    </label>
                    <textarea name="descripcion" 
                              id="descripcion"
                              rows="4"
                              placeholder="AÃ±ade detalles sobre el producto..."
                              class="block w-full rounded-lg border border-gray-300 px-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200 resize-none">{{ descripcion }}</textarea>
                </div>
            </div>

            <!-- SECCIÓN 2: STOCK Y LÍMITES -->
            <div class="border-b pb-8">
                <h2 class="text-xl font-bold text-text-dark mb-6 flex items-center">
                    <i class="bi bi-boxes text-burgundy-main me-2"></i>
                    Control de Stock
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <!-- Stock Actual (Solo lectura) -->
                    <div>
                        <label for="stock_actual" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-box-fill me-1"></i> Stock Actual
                        </label>
                        <div class="block w-full rounded-lg border border-gray-300 px-4 py-3 bg-gray-100 text-gray-700 font-bold text-lg cursor-not-allowed">
                            {{ producto.Cantidad|floatformat:0 }}
                        </div>
                        <p class="text-xs text-gray-500 mt-1">ModifÃ­calo con Ingresos/Egresos</p>
                    </div>

                    <!-- MÃ­nimo Admisible -->
                    <div>
                        <label for="minimo_admisible" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-arrow-down-square me-1"></i> MÃ­nimo Admisible
                        </label>
                        <input type="number" 
                               name="minimo_admisible" 
                               id="minimo_admisible"
                               value="{{ minimo_admisible|floatformat:0 }}"
                               step="0.01"
                               min="0"
                               placeholder="0"
                               class="block w-full rounded-lg border border-gray-300 px-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                    </div>

                    <!-- MÃ¡ximo Admisible -->
                    <div>
                        <label for="maximo_admisible" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-arrow-up-square me-1"></i> MÃ¡ximo Admisible
                        </label>
                        <input type="number" 
                               name="maximo_admisible" 
                               id="maximo_admisible"
                               value="{{ maximo_admisible|floatformat:0 }}"
                               step="0.01"
                               min="0"
                               placeholder="0"
                               class="block w-full rounded-lg border border-gray-300 px-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                    </div>
                </div>
            </div>

            <!-- SECCIÓN 3: PRECIOS -->
            <div class="pb-8">
                <h2 class="text-xl font-bold text-text-dark mb-6 flex items-center">
                    <i class="bi bi-currency-exchange text-burgundy-main me-2"></i>
                    Precios
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Precio en Guaraní -->
                    <div>
                        <label for="precio_gs" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-coin me-1"></i> Precio Unitario (Guaraní)
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-gray-500 font-bold">â‚²</span>
                            <input type="number" 
                                   name="precio_gs" 
                                   id="precio_gs"
                                   value="{{ precio_gs|floatformat:0 }}"
                                   step="0.01"
                                   min="0"
                                   placeholder="0"
                                   class="block w-full rounded-lg border border-gray-300 pl-10 pr-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                        </div>
                    </div>

                    <!-- Precio en USD -->
                    <div>
                        <label for="precio_usd" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-currency-dollar me-1"></i> Precio Unitario (USD)
                        </label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-gray-500 font-bold">$</span>
                            <input type="number" 
                                   name="precio_usd" 
                                   id="precio_usd"
                                   value="{{ precio_usd|floatformat:2 }}"
                                   step="0.01"
                                   min="0"
                                   placeholder="0.00"
                                   class="block w-full rounded-lg border border-gray-300 pl-10 pr-4 py-3 focus:ring-burgundy-main focus:border-transparent transition duration-200">
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOTONES DE ACCIÓN -->
            <div class="flex flex-col sm:flex-row justify-end gap-4 pt-6 border-t">
                <a href="{% url 'compras:detalle_producto' pk=producto.CodigoProducto %}" 
                   class="inline-flex justify-center items-center rounded-lg border border-gray-300 bg-white px-8 py-3 text-base font-semibold text-gray-700 shadow-minimal hover:bg-gray-100 transition duration-300">
                    <i class="bi bi-x-circle-fill me-2"></i> 
                    Cancelar
                </a>
                
                <button type="submit" 
                        class="inline-flex justify-center items-center rounded-lg border border-transparent bg-burgundy-main px-8 py-3 text-base font-bold text-white shadow-minimal hover:bg-burgundy-hover transition duration-300 transform hover:scale-[1.01]">
                    <i class="bi bi-check-circle-fill me-2"></i> 
                    Guardar Cambios
                </button>
            </div>
        </form>
    </div>

    <div class="mt-8 p-4 rounded-lg bg-blue-50 border border-blue-200 text-blue-800 text-sm">
        <i class="bi bi-info-circle me-2"></i>
        <strong>Nota:</strong> Los campos marcados con * son obligatorios. Para modificar el stock, usa las opciones de Ingreso o Egreso en el detalle del producto.
    </div>

</div>

{% endblock content %}